<!DOCTYPE html>
<html>
<head>
    <title>Four in a Row</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script src = "jquery.min.js"></script>
</head>
<script>
$(document).ready(function(){
    //create a new WebSocket object.
    var wsUri = "ws://10.51.1.28:10000/4inarow/server.php";   
    websocket = new WebSocket(wsUri); 
    
    websocket.onopen = function(ev) { // connection is open 
        $('#message_box').append("<div class=\"system_msg\">Connected!</div>"); //notify user
    }
    $('#send-btn').click(function(){ //use clicks message send button   
        var mymessage = $('#message').val(); //get message text
        var myname = $('#name').val(); //get user name
        
        if(myname == ""){ //empty name?
            alert("Enter your Name please!");
            return;
        }
        if(mymessage == ""){ //emtpy message?
            alert("Enter Some message Please!");
            return;
        }
        document.getElementById("name").style.visibility = "hidden";
        
        var objDiv = document.getElementById("message_box");
        objDiv.scrollTop = objDiv.scrollHeight;
        //prepare json data
        var msg = {
        player_num: myname,
        player_col: mymessage,
        };
        //convert and send data to server
        websocket.send(JSON.stringify(msg));
    });
    
    //#### Message received from server?
    websocket.onmessage = function(ev) {
        var msg = JSON.parse(ev.data); //PHP sends Json data
		var type = msg.type;
        var playerNum = msg.player_num; //message type
        var playerCol = msg.player_col; //message text
        var gameStatus = msg.game_status; //user name
      
        if(type == 'msg') 
        {
            $('#message_box').append("<div><span class=\"user_name\">"+playerNum+"</span> : <span>move-> "+playerCol+" status->"+gameStatus+"</span></div>");
        }
        if(type == 'system')
        {
            $('#message_box').append("<div class=\"system_msg\">"+umsg+"</div>");
        }
        
        $('#message').val(''); //reset text
        
        var objDiv = document.getElementById("message_box");
        objDiv.scrollTop = objDiv.scrollHeight;
    };
    
    websocket.onerror   = function(ev){$('#message_box').append("<div class=\"system_error\">Error Occurred - "+ev.data+"</div>");}; 
    websocket.onclose   = function(ev){$('#message_box').append("<div class=\"system_msg\">Connection Closed</div>");}; 
});
</script>

<body>
    <div class="chat_wrapper">
        <div class="message_box" id="message_box"></div>
        <div class="panel">
            <input type="text" name="name" id="name" placeholder="Your Name" maxlength="15" />

            <input type="text" name="message" id="message" placeholder="target column" maxlength="80" onkeydown = "if (event.keyCode == 13)document.getElementById('send-btn').click()"  />

        </div>
        <button id="send-btn" class=button>Send</button>
    </div>
</body>
</html>
